<div class="memory_enhancement_container">
    <div class="memory_enhancement_settings">
        <div class="inline-drawer">
            <div id="inline_drawer_header_content">
                <b style="font-size: 1.1rem" data-i18n="Memory Enhancement (Tables)">Memory Enhancement (Tables)</b>
                <span id="tableUpdateTag" style="cursor: pointer; background-color: #41b68188"
                    data-i18n="Click to update">Click to update</span>
            </div>

            <div class="inline-drawer-content">
                <div id="memory_enhancement_settings_inline_drawer_content">
                    <!-- ËÆ∞ÂøÜÂ¢ûÂº∫Ë°®Ê†ºÁÆ°ÁêÜ -->
                    <div style=" display: flex; flex-direction: row; justify-content: space-between; ">
                        <div style=" display: flex; flex-direction: row; gap: 10px;">
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-brands fa-github fa-lg"></i>
                                <a href="https://github.com/muyoou/st-memory-enhancement/"
                                    data-i18n="Project link">Project link</a>
                            </div>
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-solid fa-book"></i>
                                <a href="https://muyoo.com.cn/wiki/memory/start.html" data-i18n="Read tutorial">Read
                                    tutorial</a>
                            </div>
                            <div class="menu_button_icon menu_button interactable">
                                <i class="fa-solid fa-list"></i>
                                <a href="https://github.com/muyoou/st-memory-enhancement/releases"
                                    data-i18n="Changelog">Changelog</a>
                            </div>
                        </div>
                        <div class="menu_button_icon menu_button interactable" id="table_debug_log_button">
                            <i class="fa-solid fa-bug"></i>
                            <a data-i18n="Logs">Log</a>
                        </div>
                    </div>
                    <div id="table_message_tip"></div>


                    <!--                        <hr/>-->

                    <!-- Â≠êËÆæÁΩÆ -->
                    <div class="persona_management_left_column flex-container wide100p flexGap10"
                        style="padding: 10px 0; gap: 10px">
                        <div class="flex1 wide50p" style="min-width: 300px">
                            <h4 class="standoutHeader" data-i18n="Plugin settings">Plugin settings</h4>

                            <!-- Âü∫Á°ÄËÆæÁΩÆ -->
                            <div>
                                style="justify-content: space-between; align-items: center">
                                <div data-i18n="Import, export and reset plugin">Import, export and reset plugin</div>
                                <div class="flex-container">
                                    <div class="menu_button button-square-icon fa-solid fa-file-import"
                                        id="table-set-import" title="Import table presets"
                                        data-i18n="[title]Import table presets"></div>
                                    <!--                                        <input type="file" id="table-set-importFile" accept=".json" hidden>-->
                                    <div class="menu_button button-square-icon fa-solid fa-file-export"
                                        id="table-set-export" title="Export table presets"
                                        data-i18n="[title]Export table presets"></div>
                                    <div class="menu_button button-square-icon fa-solid fa-undo" id="table-reset"
                                        title="Reset table presets" data-i18n="[title]Reset table presets"></div>
                                </div>
                            </div>

                            <h4 data-i18n="Plugin switches">Plugin switches</h4>
                            <div class="checkbox_label range-block justifyLeft">
                                <input type="checkbox" id="table_switch"><span data-i18n="Enable plugin">Enable
                                    plugin</span>
                            </div>
                            <!--                                <div class="checkbox_label">-->
                            <!--                                    <input type="checkbox" id="table_switch_creator_mode"><span>Âàõ‰ΩúËÄÖÊ®°Âºè</span>-->
                            <!--                                </div>-->
                            <div class="checkbox_label range-block justifyLeft">
                                <input type="checkbox" id="table_switch_debug_mode"><span data-i18n="Debug mode">Debug
                                    mode</span>
                                <small class="toggle-description justifyLeft" data-i18n="Debug mode description">(May
                                    cause performance loss, for dev debug only)</small>
                            </div>

                            <h4 data-i18n="Message template">Message template</h4>
                            <div style="padding-left: 5px;">
                                <label for="dataTable_message_template"></label>
                                <small class="toggle-description justifyLeft"
                                    data-i18n="Message template description">(Used to instruct AI on how to use and
                                    modify tables. Use <code>{{tableData}}</code> macro to select insertion
                                    point)</small>
                                <textarea id="dataTable_message_template" class="wide100p" rows="8"></textarea>
                            </div>
                            <!-- È´òÁ∫ßËÆæÁΩÆÈÄâÈ°π -->
                            <div style="padding-left: 5px;">
                                <div style="display: flex; align-items: center;">
                                    <label for="dataTable_injection_mode" style="min-width: 50px"
                                        data-i18n="Injection">Injection:</label>
                                    <select id="dataTable_injection_mode">
                                        <option value="injection_off" data-i18n="Turn off injection">Turn off injection
                                        </option>
                                        <option value="deep_system">@D ‚öô</option>
                                        <option value="deep_user">@D üë§</option>
                                        <option value="deep_assistant">@D ü§ñ</option>
                                    </select>
                                    <label for="dataTable_deep" style="min-width: 60px; padding-left: 10px;"
                                        data-i18n="Depth">Depth:</label>
                                    <input id="dataTable_deep" class="text_pole" type="number">
                                </div>
                            </div>
                        </div>
                        <div class="flex1 wide50p" style="min-width: 300px">
                            <!-- Ë°®Ê†ºÈ¢ÑËÆæ -->
                            <div>
                                <!-- È¢ÑËÆæËÆæÁΩÆ -->
                                <h4 class="standoutHeader" data-i18n="Run strategy">Run strategy</h4>
                                <label for="fill_table_time" data-i18n="Render to">Fill table when:</label>
                                <select id="fill_table_time" class="flex1" style="min-width: 100px">
                                    <option value="chat">While chatting</option>
                                    <option value="after">After receiving message</option>
                                </select>


                                <!-- ÈªòËÆ§‰∏çÂàÜÊ≠•Â°´Ë°® -->
                                <div id="reply_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <!-- ÂàÜÊ≠•Â°´Ë°® -->
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="table_read_switch"><span
                                            data-i18n="AI read table switch">AI read table switch</span>
                                    </div>
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="table_edit_switch"><span
                                            data-i18n="AI edit table switch">AI edit table switch</span>
                                    </div>
                                </div>

                                <!-- ÂàÜÊ≠•Â°´Ë°® -->
                                <div id="step_by_step_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <div class="checkbox_label" style="display: flex; align-items: center;">
                                        <input type="checkbox" id="step_by_step_use_main_api" checked><span
                                            data-i18n="Use main API">Use main API</span>
                                        <div class="menu_button menu_button_icon" id="trigger_step_by_step_button"
                                            style="margin-left: 10px;">
                                            <i class="fa-solid fa-play"></i><a data-i18n="Fill now">Fill now</a>
                                        </div>
                                        <label for="separateReadContextLayers" style="margin-left: 10px;">Context
                                            layers</label>
                                        <input type="number" id="separateReadContextLayers" class="margin0 text_pole"
                                            style="width: 50px;" min="1" value="1" />
                                        <label for="separateReadLorebook" style="margin-left: 10px;">Read World
                                            Info</label>
                                        <input type="checkbox" id="separateReadLorebook" class="margin0" />
                                        <small class="toggle-description justifyLeft">(Not recommended for large
                                            context)</small>
                                    </div>
                                    <div style="padding-left: 5px; margin-bottom: 10px;">
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <label for="step_by_step_user_prompt"
                                                data-i18n="settings.label.stepByStepUserPrompt">Independent filling
                                                structure</label>
                                            <div class="menu_button button-square-icon fa-solid fa-undo"
                                                id="reset_step_by_step_user_prompt" title="Reset to default"
                                                data-i18n="[title]Reset to default"></div>
                                        </div>
                                        <small class="toggle-description justifyLeft"
                                            data-i18n="settings.hint.stepByStepUserPrompt">(Sent as this structure
                                            during independent filling, keep JSON parsable)</small>
                                        <textarea id="step_by_step_user_prompt"
                                            class="text_pole settings_textarea wide100p" rows="8"
                                            placeholder="Enter independent filling prompt"></textarea>
                                    </div>
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="confirm_before_execution" checked><span
                                            data-i18n="Confirm before execution">Confirm before execution</span>
                                        <small class="toggle-description justifyLeft"
                                            data-i18n="Confirm before execution description">(Show confirmation dialog
                                            when checkpoints are met)</small>
                                    </div>

                                    <div class="inline-drawer wide100p">
                                        <div class="inline-drawer-toggle inline-drawer-header">
                                            <b><span data-i18n="Custom independent API">Custom independent
                                                    API</span></b>
                                            <div class="fa-solid fa-circle-chevron-down inline-drawer-icon down"></div>
                                        </div>
                                        <div class="inline-drawer-content"
                                            style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                            <!-- Custom API Settings -->
                                            <input type="text" id="custom_api_url" class="text_pole"
                                                placeholder="API URL (end with /v1)">
                                            <input type="password" id="custom_api_key" class="text_pole"
                                                placeholder="API Key (comma separated)">
                                            <input type="text" id="custom_model_name" class="text_pole"
                                                placeholder="Model Name (manual input or auto fetch)">
                                            <div class="range-block justifyLeft">
                                                <select id="model_selector" class="text_pole">
                                                    <option value="">Please fetch model list first</option>
                                                </select>
                                                <div class="menu_button menu_button_icon" id="fetch_models_button">
                                                    <a>Fetch models</a>
                                                </div>
                                                <div class="menu_button menu_button_icon" id="table_test_api_button"
                                                    style="margin-left: 5px;">
                                                    <a>Test</a>
                                                </div>
                                            </div>
                                            <div class="flex-container slider-container"
                                                style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                                <label
                                                    style="min-width: 140px; margin: 0; white-space: nowrap; flex-shrink: 0;"
                                                    data-i18n="Custom API temperature setting">Custom API
                                                    temperature:<span id="custom_temperature_value">1.0</span></label>
                                                <input type="range" id="custom_temperature" min="0.1" max="2.0"
                                                    step="0.1" value="1.0" style="flex-grow: 1;">
                                            </div>

                                            <!-- Proxy Settings -->
                                            <div class="inline-drawer wide100p">
                                                <div class="inline-drawer-toggle inline-drawer-header">
                                                    <b><span data-i18n="Proxy settings">Proxy settings<span
                                                                style="color: red">(Not finished, do not use, leave
                                                                empty)</span></b>
                                                    <div class="fa-solid inline-drawer-icon interactable up fa-circle-chevron-up"
                                                        tabindex="0"></div>
                                                </div>
                                                <div class="inline-drawer-content"
                                                    style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                                    <input type="text" id="table_proxy_address" class="text_pole"
                                                        placeholder="Proxy address (e.g., http://127.0.0.1:7890)"
                                                        data-i18n="[placeholder]Proxy address (e.g., http://127.0.0.1:7890)">
                                                    <input type="password" id="table_proxy_key" class="text_pole"
                                                        placeholder="Proxy key (optional)"
                                                        data-i18n="[placeholder]Proxy key (optional)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Reorganize Tables -->
                            <div class="inline-drawer wide100p">
                                <div class="inline-drawer-toggle inline-drawer-header">
                                    <b><span data-i18n="Reorganize tables">Table Summary/Reorganization</span></b>
                                    <div class="fa-solid fa-circle-chevron-down inline-drawer-icon down"></div>
                                </div>
                                <div class="inline-drawer-content" style="display: none; ">
                                    <div class="checkbox_label" range-block justifyLeft>
                                        <input type="checkbox" id="use_main_api" checked><span
                                            data-i18n="Use main API">Use main API</span>
                                    </div>

                                    <!-- È´òÁ∫ßËÆæÁΩÆÈÄâÈ°π -->
                                    <!-- <div class="flex-container slider-container" style="margin: 5px; padding-bottom: 10px;" id="clear_up_stairs_container">
                                        <label><span data-i18n="Reference recent chat history">ÂèÇËÄÉÊúÄËøëËÅäÂ§©ËÆ∞ÂΩïÔºö</span><code id="clear_up_stairs_value">9Êù°</code></label>
                                        <input type="range" id="clear_up_stairs" min="1" max="99" step="1" value="9" style="width: calc(100% - 20px);">
                                    </div> -->
                                    <div class="flex-container slider-container"
                                        style="margin: 5px; padding-bottom: 10px" id="token_limit_container">
                                        <label><span data-i18n="Token limit">Token limit:</span><code
                                                id="rebuild_token_limit_value">10000</code></label>
                                        <input type="range" id="rebuild_token_limit" min="1000" max="100000" step="1000"
                                            value="10000" style="width: calc(100% - 20px);">
                                    </div>
                                    <!-- Blocking options, changed to default token limit -->
                                    <!-- <div class="checkbox_label">
                                        <input type="checkbox" id="use_token_limit"><span data-i18n="Use token limit instead of chat history limit">Use token limit instead of message count</span>
                                    </div> -->
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="ignore_user_sent" checked><span
                                            data-i18n="Only reference AI replies">Only reference AI replies</span>
                                    </div>
                                    <div class="checkbox_label range-block justifyLeft">
                                        <input type="checkbox" id="bool_silent_refresh"><span
                                            data-i18n="Skip confirmation dialog after reorganizing">Skip confirmation
                                            after summary</span>
                                    </div>

                                    <div class="flex-container" style="flex-wrap: nowrap; padding-top: 10px;">
                                        <b style="width: 170px;">Summary template</b>
                                        <select id="rebuild--select">
                                        </select>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-pencil"
                                            id="rebuild--set-rename" title="Edit summary template"></div>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-plus"
                                            id="rebuild--set-new" title="Create summary template"></div>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-file-import"
                                            id="rebuild--set-import" title="Import summary template"></div>
                                        <input type="file" id="rebuild--set-importFile" accept=".json" hidden>
                                        <div class="rebuild--add menu_button menu_button_icon fa-solid fa-file-export"
                                            id="rebuild--set-export" title="Export summary template"></div>
                                        <div class="rebuild--del menu_button menu_button_icon fa-solid fa-trash redWarningBG"
                                            id="rebuild--set-delete" title="Delete this template"></div>
                                    </div>

                                    <div style="display: flex; width: calc(100% - 20px);">
                                        <div class="menu_button menu_button_icon" id="table_clear_up">
                                            <i class="fa-solid fa-repeat"></i><a
                                                data-i18n="Reorganize tables now">Reorganize table now</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--                        <hr/>-->

                            <!-- Ë°®Ê†ºÊé®ÈÄÅËá≥ÂØπËØù -->
                            <div class="flex1 wide100p">
                                <h4 class="standoutHeader" data-i18n="Frontend table (status bar)">Frontend Table
                                    (Status Bar)</h4>
                                <!--                            <b class="table_setting_category_header">Ë°®Ê†ºÊé®ÈÄÅËá≥ÂØπËØù</b><div style="height: 10px;"></div>-->
                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="show_settings_in_extension_menu" checked><span
                                        data-i18n="Access tables from extensions menu">Access from extensions
                                        menu</span>
                                </div>
                                <!--                                <div class="checkbox_label range-block justifyLeft unfinished">-->
                                <!--                                    <input type="checkbox" id="show_drawer_in_extension_list" checked><span>Âú®Êâ©Â±ïÂàóË°®ÊòæÁ§∫Ë°®Ê†ºËÆæÁΩÆ</span>-->
                                <!--                                </div>-->

                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="table_to_chat"><span
                                        data-i18n="Render table view in conversation">Render table to chat</span>
                                    <small class="toggle-description justifyLeft"
                                        data-i18n="Render table view in conversation description">(Show custom table in
                                        chat)</small>
                                </div>

                                <div class="checkbox_label range-block justifyLeft">
                                    <input type="checkbox" id="alternate_switch" checked><span
                                        data-i18n="Render table view in alternate model">Interleaved mode</span>
                                    <small class="toggle-description justifyLeft"
                                        data-i18n="Render table view in alternate model description">(Enable interleaved
                                        rendering in chat)</small>
                                </div>


                                <!-- Ë°®Ê†ºÊé®ÈÄÅËá≥ÂØπËØù -->
                                <div id="table_to_chat_options" style="padding-left: 20px; width: calc(100% - 20px);">
                                    <!-- TODO ËøôÈáåÈúÄË¶ÅÂÆûÁé∞<div class="checkbox_label range-block justifyLeft unfinished">
                                        <input type="checkbox" id="table_to_chat_can_edit"><span data-i18n="Data editable">Êï∞ÊçÆÂèØÁºñËæë</span>
                                        <small class="toggle-description justifyLeft" data-i18n="Data editable description">(ÂèØÁî®Ê∏≤ÊüìËá≥ÂØπËØùÁöÑË°®Ê†ºÁºñËæëÊï∞ÊçÆ)</small>
                                    </div> -->

                                    <div class="checkbox_label range-block justifyLeft">
                                        <label for="table_to_chat_mode" data-i18n="Render to">Render to</label>
                                        <select id="table_to_chat_mode" class="flex1" style="min-width: 100px">
                                            <option value="context_bottom" data-i18n="Bottom of context">Bottom of
                                                context
                                            </option>
                                            <option value="last_message" data-i18n="Inside last message">Inside last
                                                message
                                            </option>
                                            <!--                                            <option value="macro">Ëá™ÂÆö‰πâ‰ΩçÁΩÆÔºàÂÆèÔºâ</option>-->
                                        </select>
                                        <small id="table_to_chat_is_micro_d" class="toggle-description justifyLeft"
                                            data-i18n="Use custom display location">Use <code>{{sheetsView}}</code>
                                            for custom position</small>
                                    </div>

                                    <div class="menu_button menu_button_icon" id="dataTable_to_chat_button"
                                        style="margin-top: 10px">
                                        <i class="fa-solid fa-wand-magic-sparkles"></i><a
                                            data-i18n="Edit style of tables rendered in conversation">Edit render
                                            style</a>
                                    </div>
                                </div>

                                <!-- Advanced Settings -->
                                <div class="inline-drawer wide100p">
                                    <div class="inline-drawer-toggle inline-drawer-header">
                                        <b><span data-i18n="Advanced rendering settings">Advanced rendering
                                                settings</span></b>
                                        <div class="fa-solid fa-circle-chevron-down inline-drawer-icon down">
                                        </div>
                                    </div>
                                    <div class="inline-drawer-content"
                                        style="display: none; padding-left: 20px; width: calc(100% - 20px)">
                                        <!-- Advanced Options -->
                                        <div class="checkbox_label range-block justifyLeft">
                                            <label for="table_cell_width_mode" data-i18n="Render to">Cell
                                                display</label>
                                            <select id="table_cell_width_mode" class="flex1" style="min-width: 100px">
                                                <option value="single_line">No line break</option>
                                                <option value="wide1_cell">Wide</option>
                                                <option value="wide1_2_cell">Half width</option>
                                                <option value="wide1_4_cell">1/4 width</option>
                                            </select>
                                            <small id="table_to_chat_is_micro_d"
                                                class="toggle-description justifyLeft">Cell display mode for all
                                                tables</small>
                                        </div>
                                        <div class="checkbox_label range-block justifyLeft">
                                            <input type="checkbox" id="high_performance_sheets_render"><span
                                                data-i18n="Disable dynamic effects in table plugin">Disable dynamic
                                                effects</span>
                                            <small class="toggle-description justifyLeft"
                                                data-i18n="Disable dynamic effects description">(Try enabling if lag
                                                occurs)</small>
                                        </div>
                                        <div class="checkbox_label range-block justifyLeft">
                                            <input type="checkbox" id="gpu_assist_sheets_render"><span
                                                data-i18n="Disable GPU table rendering">Disable GPU rendering</span>
                                            <small class="toggle-description justifyLeft"
                                                data-i18n="Disable GPU table rendering description">(Manually disable
                                                GPU rendering)</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>